<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="PTCG Raid Battle System - Enhanced Unified Edition">
    <meta name="author" content="PTCG Sim Meta Team">
    
    <title>üéÆ PTCG Raid System - Enhanced Unified Edition</title>
    
    <!-- MODULAR CSS SYSTEM -->
    <link rel="stylesheet" href="css/pokemon-raid-system.css">
    <link rel="stylesheet" href="css/pokemon-raid-interactive.css">
    <link rel="stylesheet" href="css/raid-launcher.css">
    <link rel="stylesheet" href="css/raid-components.css">
    <link rel="stylesheet" href="css/raid-animations.css">
    
    <meta name="theme-color" content="#0075c9">
    
    <style>
        /* ================ AUTHENTIC POKEMON TCG RAID BATTLE ================ */
        
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
        }
        
        #raidLauncher {
            width: 100vw;
            min-height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            box-sizing: border-box;
        }
        
        #raidContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 117, 201, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 204, 0, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: none; /* Hidden by default until user chooses to start */
        }
        
        /* ================ BATTLEFIELD MAIN ================ */
        
        .battlefield-main {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            background: 
                linear-gradient(45deg, rgba(0, 168, 81, 0.1) 0%, transparent 50%),
                radial-gradient(circle at center, rgba(0, 117, 201, 0.1) 0%, transparent 70%);
        }
        
        /* Boss Pokemon Zone */
        .boss-pokemon-zone {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 10;
        }
        
        .boss-card-display {
            width: 180px;
            height: 252px;
            background: linear-gradient(135deg, #dc143c 0%, #b71c1c 100%);
            border: 4px solid #ffd700;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .boss-card-display:hover {
            transform: scale(1.05);
        }
        
        .boss-card-display img {
            width: 100%;
            height: 65%;
            object-fit: cover;
        }
        
        .boss-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 15px;
            color: white;
        }
        
        .boss-name {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .boss-hp {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .boss-hp-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .boss-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444 0%, #cc0000 100%);
            transition: width 0.8s ease;
        }
        
        .boss-ko {
            font-size: 12px;
            text-align: center;
        }
        
        /* Boss Attack Cards - Compact */
        .boss-attack-mini {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .draw-btn-mini {
            padding: 6px 12px;
            background: #00a651;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .attack-cards-mini {
            display: flex;
            gap: 5px;
        }
        
        .attack-card-mini {
            width: 25px;
            height: 35px;
            background: #666;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            cursor: pointer;
        }
        
        .attack-card-mini.revealed {
            background: #ff6b6b;
            border-color: #c23616;
        }
        
        /* Player Battle Zones */
        .player-battle-zones {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .player-profile-card {
            position: absolute;
            width: 200px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.98) 100%);
            border: 3px solid #0075c9;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            pointer-events: all;
            transition: all 0.3s ease;
            color: #333;
        }
        
        .player-profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 117, 201, 0.4);
        }
        
        .player-profile-card.current-turn {
            border-color: #ffcc00;
            animation: playerTurnGlow 2s ease-in-out infinite;
        }
        
        @keyframes playerTurnGlow {
            0%, 100% { box-shadow: 0 10px 25px rgba(255, 204, 0, 0.5); }
            50% { box-shadow: 0 15px 35px rgba(255, 204, 0, 0.8); }
        }
        
        .player-profile-card.ko {
            opacity: 0.6;
            border-color: #dc143c;
        }
        
        /* Player positioning - Adjusted to avoid UI panel overlaps */
        .player-profile-card[data-position="1"] {
            top: 120px;
            left: 270px;
        }
        
        .player-profile-card[data-position="2"] {
            top: 120px;
            right: 270px;
        }
        
        .player-profile-card[data-position="3"] {
            bottom: 320px;
            left: 270px;
        }
        
        .player-profile-card[data-position="4"] {
            bottom: 320px;
            right: 270px;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
        }
        
        .player-name {
            font-size: 14px;
            font-weight: bold;
            color: #0075c9;
        }
        
        .player-ko-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .player-ko-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .player-pokemon-zones {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .player-active-zone, .player-bench-zone {
            flex: 1;
        }
        
        .zone-label {
            font-size: 10px;
            font-weight: bold;
            color: #666;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .pokemon-card-slot {
            width: 100%;
            height: 80px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            overflow: hidden;
            position: relative;
        }
        
        .pokemon-card-slot.active-slot {
            border-color: #ffcc00;
            background: linear-gradient(135deg, #fff9c4 0%, #f8f9fa 100%);
        }
        
        .pokemon-card-slot.bench-slot {
            border-color: #00a651;
            background: linear-gradient(135deg, #e8f5e8 0%, #f8f9fa 100%);
        }
        
        .pokemon-card-slot.has-pokemon {
            border-style: solid;
        }
        
        .pokemon-card-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-placeholder {
            text-align: center;
            color: #999;
            font-size: 10px;
            font-weight: bold;
        }
        
        .player-info {
            font-size: 11px;
            color: #666;
            line-height: 1.2;
        }
        
        /* Center Battlefield */
        .center-battlefield {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .turn-display {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #0075c9;
        }
        
        /* ================ FLOATING UI PANELS ================ */
        
        .ui-panels {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50; /* Lower z-index than status bar */
        }
        
        .floating-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #0075c9;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            pointer-events: all;
            min-width: 200px;
            max-width: 280px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .panel-header {
            background: #0075c9;
            color: white;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }
        
        .panel-header h3 {
            margin: 0;
            font-size: 14px;
        }
        
        .panel-minimize {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
        }
        
        .panel-body {
            padding: 12px;
            color: white;
        }
        
        .panel-body.minimized {
            display: none;
        }
        
        /* Team Panel - Top Left, non-overlapping */
        .team-panel {
            top: 20px;
            left: 20px;
            width: 220px;
        }
        
        /* Chat Panel - Bottom Left, non-overlapping */
        .chat-panel {
            bottom: 80px;
            left: 20px;
            width: 250px;
            height: 200px;
        }
        
        /* Debug Panel - Top Right */
        .debug-panel {
            top: 20px;
            right: 20px;
            width: 220px;
        }
        
        /* Menu Panel - Top Right, below debug */
        .menu-panel {
            top: 280px;
            right: 20px;
            width: 200px;
        }
        
        /* ================ BATTLE STATUS BAR ================ */
        
        .battle-status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(26, 26, 46, 0.95) 100%);
            border-top: 2px solid #0075c9;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            backdrop-filter: blur(10px);
            z-index: 100; /* Highest z-index */
        }
        
        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }
        
        .status-center {
            flex: 1;
            text-align: center;
        }
        
        .phase-indicator {
            font-size: 16px;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .end-turn-btn {
            padding: 8px 16px;
            background: #00a651;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .end-turn-btn:hover {
            background: #008a43;
        }
        
        .leave-game-btn {
            padding: 8px 16px;
            background: #dc143c;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .leave-game-btn:hover {
            background: #b71c1c;
        }
        
        .damage-quick-input {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .damage-quick-input input {
            width: 60px;
            padding: 6px;
            border: 1px solid #666;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-align: center;
            font-size: 12px;
        }
        
        .damage-quick-input button {
            padding: 6px 10px;
            background: #dc143c;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        /* ================ RESPONSIVE DESIGN ================ */
        
        @media (max-width: 768px) {
            .floating-panel {
                max-width: 250px;
                font-size: 12px;
            }
            
            .player-profile-card {
                width: 150px;
                padding: 10px;
            }
            
            .boss-card-display {
                width: 140px;
                height: 196px;
            }
            
            .battle-status-bar {
                padding: 0 10px;
                font-size: 12px;
            }
            
            .status-left, .status-right {
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .floating-panel {
                position: fixed;
                bottom: 70px;
                left: 10px;
                right: 10px;
                max-width: none;
            }
            
            .player-profile-card {
                position: relative;
                width: 100%;
                margin: 10px 0;
                transform: none !important;
            }
            
            .player-battle-zones {
                position: relative;
                padding: 10px;
                overflow-y: auto;
            }
        }
        
        /* Panel Component Styles */
        .your-active-zone, .your-bench-zone {
            margin-bottom: 15px;
        }
        
        .your-active-zone h4, .your-bench-zone h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #0075c9;
        }
        
        .team-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .action-btn {
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn.primary {
            background: #dc143c;
            color: white;
        }
        
        .action-btn.secondary {
            background: #8b3a8b;
            color: white;
        }
        
        .action-btn.tertiary {
            background: #6c757d;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .chat-messages {
            height: 120px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .chat-message {
            margin-bottom: 5px;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .chat-message.system {
            background: rgba(0, 117, 201, 0.3);
            color: #87ceeb;
        }
        
        .chat-input-area {
            display: flex;
            gap: 5px;
        }
        
        .chat-input-area input {
            flex: 1;
            padding: 6px;
            border: 1px solid #666;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
        }
        
        .chat-input-area button {
            padding: 6px 12px;
            background: #0075c9;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .debug-info {
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .debug-info div {
            margin-bottom: 3px;
        }
        
        .debug-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .debug-btn {
            padding: 6px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }
        
        .debug-btn:hover {
            background: #5a6268;
        }
        
        .menu-section {
            margin-bottom: 12px;
        }
        
        .menu-section h4 {
            margin: 0 0 6px 0;
            font-size: 12px;
            color: #0075c9;
            border-bottom: 1px solid #333;
            padding-bottom: 3px;
        }
        
        .menu-btn {
            width: 100%;
            padding: 6px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            text-align: left;
            cursor: pointer;
            margin-bottom: 3px;
        }
        
        .menu-btn:hover {
            background: #5a6268;
        }
        
        /* Pokemon Selection Grid */
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .pokemon-option {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.98) 100%);
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
        }
        
        .pokemon-option:hover {
            border-color: #0075c9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 117, 201, 0.3);
        }
        
        .pokemon-option.selected {
            border-color: #ffcc00;
            background: linear-gradient(135deg, #fff9c4 0%, #f8f9fa 100%);
        }
        
        .pokemon-option img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        
        .pokemon-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .pokemon-type {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .pokemon-hp {
            font-size: 12px;
            color: #0075c9;
        }
        
        .selected-pokemon {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .selected-slot {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            color: #333;
        }
        
        .selected-slot h4 {
            margin: 0 0 10px 0;
            color: #0075c9;
        }
        
        .slot-content {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .slot-content img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <!-- POKEMON RAID LAUNCHER -->
    <div id="raidLauncher" class="raid-launcher">
        <header class="launcher-header">
            <h1>‚ö° Pokemon Raid Battle System</h1>
            <div class="version">Enhanced Unified Edition v5.0 - All Features Integrated</div>
        </header>
        
        <!-- POKEMON TEAM SELECTION -->
        <div class="pokemon-selection">
            <h3>üéØ Choose Your Pokemon Team</h3>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">
                Select 2 Pokemon for your raid team (1 Active, 1 Bench)
            </p>
            
            <div class="pokemon-grid" id="pokemonGrid">
                <!-- Pokemon options populated by JavaScript -->
                <div class="pokemon-option" data-pokemon-id="25" onclick="selectPokemon(25)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Pikachu">
                    <div class="pokemon-name">Pikachu</div>
                    <div class="pokemon-type">Electric</div>
                    <div class="pokemon-hp">HP: 120</div>
                </div>
                <div class="pokemon-option" data-pokemon-id="7" onclick="selectPokemon(7)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png" alt="Squirtle">
                    <div class="pokemon-name">Squirtle</div>
                    <div class="pokemon-type">Water</div>
                    <div class="pokemon-hp">HP: 100</div>
                </div>
                <div class="pokemon-option" data-pokemon-id="4" onclick="selectPokemon(4)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png" alt="Charmander">
                    <div class="pokemon-name">Charmander</div>
                    <div class="pokemon-type">Fire</div>
                    <div class="pokemon-hp">HP: 110</div>
                </div>
                <div class="pokemon-option" data-pokemon-id="1" onclick="selectPokemon(1)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png" alt="Bulbasaur">
                    <div class="pokemon-name">Bulbasaur</div>
                    <div class="pokemon-type">Grass</div>
                    <div class="pokemon-hp">HP: 120</div>
                </div>
                <div class="pokemon-option" data-pokemon-id="6" onclick="selectPokemon(6)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png" alt="Charizard">
                    <div class="pokemon-name">Charizard</div>
                    <div class="pokemon-type">Fire/Flying</div>
                    <div class="pokemon-hp">HP: 180</div>
                </div>
                <div class="pokemon-option" data-pokemon-id="9" onclick="selectPokemon(9)">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png" alt="Blastoise">
                    <div class="pokemon-name">Blastoise</div>
                    <div class="pokemon-type">Water</div>
                    <div class="pokemon-hp">HP: 170</div>
                </div>
            </div>
            
            <div class="selected-pokemon">
                <div class="selected-slot" id="activeSlot">
                    <h4>üî• Active Pokemon</h4>
                    <div class="slot-content" id="activeSlotContent">Click a Pokemon above to select as Active</div>
                </div>
                <div class="selected-slot" id="benchSlot">
                    <h4>üîπ Bench Pokemon</h4>
                    <div class="slot-content" id="benchSlotContent">Click a Pokemon above to select as Bench</div>
                </div>
            </div>
        </div>

        <!-- Main Actions -->
        <section class="button-group">
            <button class="raid-button create-raid" id="createRaidBtn" type="button">
                Create New Raid
            </button>
            <button class="raid-button join-raid" id="joinRaidBtn" type="button">
                Join Existing Raid
            </button>
        </section>

        <!-- Input Fields -->
        <section class="input-section">
            <input 
                type="text" 
                class="raid-input" 
                id="raidIdInput" 
                placeholder="Enter Raid ID to join"
                maxlength="20"
                autocomplete="off"
            >
            <input 
                type="text" 
                class="raid-input" 
                id="usernameInput" 
                placeholder="Your trainer name" 
                value="Trainer"
                maxlength="20"
                autocomplete="username"
            >
        </section>

        <!-- Layout and Test Controls -->
        <section class="button-group">
            <button class="raid-button layout-toggle" id="launcherToggleLayoutBtn" type="button">
                View Mode: Battlefield
            </button>
            <button class="raid-button test-button" id="testMultiplayerBtn" type="button">
                üß™ Test Multiplayer
            </button>
            <button class="raid-button demo-button" id="quickDemoBtn" type="button">
                üé≤ Quick Demo
            </button>
        </section>

        <!-- Status Log -->
        <section class="raid-status" id="raidStatusLog" role="log" aria-live="polite">
            <div><strong>üöÄ Pokemon Raid Battle System Status</strong></div>
            <div>Status: <span id="connectionStatusDisplay">Initializing...</span></div>
            <div>Interface: Enhanced Unified Edition with All Features</div>
            <div>Features: 3D Battlefield, Player Cards, Pokemon Selection, Turn Management, Chat, Debug</div>
            <div style="color: #00a651; font-weight: bold; margin-top: 10px;">
                ‚úÖ Default Pokemon team loaded - Ready to create or join raids!
            </div>
        </section>
    </div>

    <!-- MAIN POKEMON RAID BATTLE INTERFACE -->
    <div id="raidContainer" class="raid-container">
        <!-- Authentic Pokemon TCG Battlefield -->
        <div class="battlefield-main">
            <!-- Boss Pokemon Zone (Center Top) -->
            <div class="boss-pokemon-zone">
                <div class="boss-card-display">
                    <img id="bossImage" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Boss Pokemon">
                    <div class="boss-info">
                        <div class="boss-name" id="bossName">Pikachu ‚òÖ‚òÖ‚òÖ</div>
                        <div class="boss-hp">
                            <span>HP: <span id="bossHP">2800</span></span>
                            <div class="boss-hp-bar">
                                <div class="boss-hp-fill" id="bossHPFill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="boss-ko">KO: <span id="bossKO">0</span></div>
                    </div>
                </div>
                
                <!-- Boss Attack Cards (Small, Compact) -->
                <div class="boss-attack-mini">
                    <button id="drawAttackCard" class="draw-btn-mini">Draw Attack Card</button>
                    <div class="attack-cards-mini">
                        <div class="attack-card-mini" data-slot="1">?</div>
                        <div class="attack-card-mini" data-slot="2">?</div>
                        <div class="attack-card-mini" data-slot="3">?</div>
                        <div class="attack-card-mini" data-slot="4">?</div>
                    </div>
                </div>
            </div>
            
            <!-- Player Battle Zones (4 Corners) -->
            <div class="player-battle-zones" id="playerBattleZones">
                <!-- Players will be positioned here dynamically -->
            </div>
            
            <!-- Center Battlefield Area -->
            <div class="center-battlefield">
                <div class="battlefield-effects">
                    <!-- Battle effects, animations -->
                </div>
                <div class="turn-display">
                    <span id="currentTurnDisplay">Boss Turn</span>
                </div>
            </div>
        </div>
        
        <!-- Floating UI Panels -->
        <div class="ui-panels">
            <!-- Your Pokemon Team Panel -->
            <div id="teamPanel" class="floating-panel team-panel">
                <div class="panel-header">
                    <h3>üéÆ Your Team</h3>
                    <button class="panel-minimize" id="teamMinimize">‚àí</button>
                </div>
                <div class="panel-body" id="teamBody">
                    <div class="your-active-zone">
                        <h4>Active Pokemon</h4>
                        <div class="pokemon-card-slot active-slot" id="yourActiveSlot">
                            <div class="card-placeholder">
                                <span>ACTIVE SPOT</span>
                            </div>
                        </div>
                    </div>
                    <div class="your-bench-zone">
                        <h4>Bench</h4>
                        <div class="pokemon-card-slot bench-slot" id="yourBenchSlot">
                            <div class="card-placeholder">
                                <span>BENCH</span>
                            </div>
                        </div>
                    </div>
                    <div class="team-actions">
                        <button class="action-btn primary" id="attackBtn">‚öîÔ∏è Attack</button>
                        <button class="action-btn secondary" id="switchBtn">üîÑ Switch</button>
                        <button class="action-btn tertiary" id="defendBtn">üõ°Ô∏è Defend</button>
                    </div>
                </div>
            </div>
            
            <!-- Battle Chat Panel -->
            <div id="chatPanel" class="floating-panel chat-panel">
                <div class="panel-header">
                    <h3>üí¨ Battle Chat</h3>
                    <button class="panel-minimize" id="chatMinimize">‚àí</button>
                </div>
                <div class="panel-body" id="chatBody">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message system">üéÆ Battle communication ready!</div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="Type message..." maxlength="200">
                        <button id="sendChatBtn">Send</button>
                    </div>
                </div>
            </div>
            
            <!-- Debug/Testing Panel -->
            <div id="debugPanel" class="floating-panel debug-panel">
                <div class="panel-header">
                    <h3>üêû Debug & Testing</h3>
                    <button class="panel-minimize" id="debugMinimize">‚àí</button>
                </div>
                <div class="panel-body" id="debugBody">
                    <div class="debug-info">
                        <div>Socket: <span id="socketStatus">Connected</span></div>
                        <div>Players: <span id="playerCount">1/4</span></div>
                        <div>Phase: <span id="gamePhase">Battle</span></div>
                    </div>
                    <div class="debug-actions">
                        <button class="debug-btn" onclick="testBossAttack()">Boss Attack</button>
                        <button class="debug-btn" onclick="testPlayerDamage()">Damage Player</button>
                        <button class="debug-btn" onclick="testHealPlayer()">Heal Player</button>
                        <button class="debug-btn" onclick="resetBattle()">Reset Battle</button>
                    </div>
                </div>
            </div>
            
            <!-- Game Menu Panel -->
            <div id="menuPanel" class="floating-panel menu-panel">
                <div class="panel-header">
                    <h3>‚öôÔ∏è Game Menu</h3>
                    <button class="panel-minimize" id="menuMinimize">‚àí</button>
                </div>
                <div class="panel-body" id="menuBody">
                    <div class="menu-section">
                        <h4>View</h4>
                        <button class="menu-btn" id="switchViewBtn">üì± Switch View</button>
                        <button class="menu-btn" id="fullscreenBtn">üñ•Ô∏è Fullscreen</button>
                        <button class="menu-btn" id="centerViewBtn">üéØ Center View</button>
                    </div>
                    <div class="menu-section">
                        <h4>Game</h4>
                        <button class="menu-btn" id="pauseBtn">‚è∏Ô∏è Pause</button>
                        <button class="menu-btn" id="saveBtn">üíæ Save</button>
                        <button class="menu-btn" id="leaveBtn">üö™ Leave</button>
                    </div>
                    <div class="menu-section">
                        <h4>Help</h4>
                        <button class="menu-btn" id="rulesBtn">üìñ Rules</button>
                        <button class="menu-btn" id="tutorialBtn">üéì Tutorial</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Battle Status Bar -->
        <div class="battle-status-bar">
            <div class="status-left">
                <span>Raid: <span id="raidIdStatus">DEMO-RAID</span></span>
                <span>Turn: <span id="turnCounter">1</span></span>
            </div>
            <div class="status-center">
                <div class="phase-indicator" id="phaseIndicator">Boss Pokemon's Turn</div>
            </div>
            <div class="status-right">
                <button class="end-turn-btn" id="endTurnBtn">End Turn</button>
                <div class="damage-quick-input">
                    <input type="number" id="quickDamage" placeholder="DMG" min="0" max="999" step="10">
                    <button id="addQuickDamage">Add</button>
                </div>
                <button class="leave-game-btn" id="leaveGameBtn">üö™ Leave Game</button>
            </div>
        </div>
    </div>

    <!-- POKEMON DETAIL MODAL -->
    <div id="pokemonDetailModal" class="pokemon-detail-modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalPokemonName">Pokemon Details</h2>
                <button class="modal-close" id="closePokemonModal">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="pokemon-detail-layout">
                    <!-- Pokemon Image/Icon -->
                    <div class="pokemon-image-section">
                        <div class="pokemon-icon-large" id="modalPokemonIcon">üéÆ</div>
                        <div class="pokemon-type-large" id="modalPokemonType">TYPE</div>
                    </div>
                    
                    <!-- Pokemon Stats -->
                    <div class="pokemon-stats-section">
                        <h3>üìä Stats</h3>
                        <div class="stat-grid">
                            <div class="stat-row">
                                <span class="stat-name">HP:</span>
                                <span class="stat-value" id="modalPokemonHP">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-name">Rarity:</span>
                                <span class="stat-value" id="modalPokemonRarity">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-name">Weakness:</span>
                                <span class="stat-value" id="modalPokemonWeakness">-</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-name">Resistance:</span>
                                <span class="stat-value" id="modalPokemonResistance">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pokemon Moves -->
                    <div class="pokemon-moves-section">
                        <h3>‚öîÔ∏è Moves</h3>
                        <div id="modalPokemonMoves" class="moves-list">
                            <!-- Moves will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Pokemon Abilities -->
                    <div class="pokemon-abilities-section">
                        <h3>‚ú® Abilities</h3>
                        <div id="modalPokemonAbilities" class="abilities-list">
                            <!-- Abilities will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ATTACK SELECTION MODAL -->
    <div id="attackSelectionModal" class="attack-selection-modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öîÔ∏è Choose Your Attack</h2>
                <button class="modal-close" id="closeAttackModal">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="active-pokemon-info">
                    <div class="pokemon-icon-small" id="attackModalPokemonIcon">‚ö°</div>
                    <span id="attackModalPokemonName">Active Pokemon</span>
                </div>
                
                <div class="attack-options" id="attackOptions">
                    <!-- Attack options will be populated here -->
                </div>
                
                <div class="attack-modal-footer">
                    <button class="modal-button cancel-btn" id="cancelAttack">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME NOTIFICATIONS -->
    <div id="gameNotifications" class="game-notifications">
        <!-- Notifications will appear here -->
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/raid-core.js"></script>

    <!-- Pokemon Raid System Initialization -->
    <script>
        // ==================== ENHANCED UNIFIED RAID SYSTEM ====================
        
        let raidSystem;
        let gameState = {
            isConnected: false,
            currentRaid: null,
            playerId: 'player1',
            username: 'Host Player',
            selectedPokemon: {
                active: null,
                bench: null,
            },
            players: new Map(),
            boss: {
                name: 'Pikachu ‚òÖ‚òÖ‚òÖ',
                hp: 2800,
                maxHp: 2800,
                level: 3,
                ko: 0
            },
            currentPhase: 'battle',
            turnCounter: 1,
            debugMode: true
        };

        // Initialize the system when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Initializing Authentic Pokemon TCG Raid System...');
            
            // Initialize core system
            if (typeof PokemonRaidCore !== 'undefined') {
                raidSystem = new PokemonRaidCore();
                raidSystem.initializeSystem();
                console.log('‚úÖ Pokemon Raid Core initialized');
            } else {
                console.log('‚ö†Ô∏è Pokemon Raid Core not available, using enhanced fallback system');
                initializeEnhancedSystem();
            }
            
            // Set up enhanced features
            setupPokemonDatabase();
            setupEventHandlers();
            setupUIToggling();
            setupLauncherHandlers();
            
            // Add debug logging for button clicks
            const createBtn = document.getElementById('createRaidBtn');
            const joinBtn = document.getElementById('joinRaidBtn');
            
            if (createBtn) {
                console.log('‚úÖ Create Raid button found and accessible');
                createBtn.addEventListener('click', () => {
                    console.log('üîò Create Raid button clicked!');
                });
            } else {
                console.error('‚ùå Create Raid button not found!');
            }
            
            if (joinBtn) {
                console.log('‚úÖ Join Raid button found and accessible');
                joinBtn.addEventListener('click', () => {
                    console.log('üîò Join Raid button clicked!');
                });
            } else {
                console.error('‚ùå Join Raid button not found!');
            }
            
            // DON'T auto-start demo - let user choose
            console.log('üöÄ Authentic Pokemon TCG System ready! Use launcher to start.');
            console.log('üéØ Default Pokemon team:', gameState.selectedPokemon);
        });

        // ==================== ENHANCED FALLBACK SYSTEM ====================
        
        function initializeEnhancedSystem() {
            console.log('üîÑ Starting enhanced Pokemon TCG system...');
            
            // Initialize Socket.IO if available
            if (typeof io !== 'undefined') {
                const socket = io();
                
                socket.on('connect', () => {
                    console.log('‚úÖ Socket connected');
                    gameState.isConnected = true;
                    updateSocketStatus('Connected');
                    
                    // Update connection status display
                    const statusDisplay = document.getElementById('connectionStatusDisplay');
                    if (statusDisplay) {
                        statusDisplay.textContent = 'Connected to Server';
                        statusDisplay.style.color = '#00a651';
                    }
                });
                
                socket.on('disconnect', () => {
                    console.log('‚ùå Socket disconnected');
                    gameState.isConnected = false;
                    updateSocketStatus('Disconnected');
                    
                    // Update connection status display
                    const statusDisplay = document.getElementById('connectionStatusDisplay');
                    if (statusDisplay) {
                        statusDisplay.textContent = 'Disconnected from Server';
                        statusDisplay.style.color = '#dc143c';
                    }
                });
                
                socket.on('connect_error', (error) => {
                    console.error('üî• Socket connection error:', error);
                    addChatMessage('System', '‚ö†Ô∏è Connection error - using offline mode', 'error');
                });
                
                // ==================== RAID EVENT LISTENERS ====================
                
                socket.on('raidCreated', (data) => {
                    console.log('üè¥‚Äç‚ò†Ô∏è Raid created:', data);
                    setupCreatedRaid(data);
                });
                
                socket.on('raidJoined', (data) => {
                    console.log('ü§ù Raid joined:', data);
                    setupJoinedRaid(data);
                });
                
                socket.on('raidStateUpdate', (data) => {
                    console.log('üîÑ Raid state update:', data);
                    
                    // Update game state with server data
                    if (data.raid) {
                        gameState.currentRaid = data.raid;
                    }
                    
                    if (data.boss) {
                        gameState.boss = data.boss;
                    }
                    
                    if (data.players) {
                        if (gameState.currentRaid) {
                            gameState.currentRaid.players = data.players;
                        }
                    }
                    
                    // Update all displays with new server data
                    updateAllDisplays();
                    
                    addChatMessage('System', 'üîÑ Game state synchronized', 'system');
                });
                
                socket.on('playerJoined', (data) => {
                    console.log('üëã Player joined:', data);
                    
                    if (gameState.currentRaid && data.player) {
                        // Add the new player to our local state
                        const existingPlayer = gameState.currentRaid.players.find(p => p.id === data.player.id);
                        if (!existingPlayer) {
                            gameState.currentRaid.players.push(data.player);
                        }
                        
                        updatePlayerProfileCards();
                        updateDebugInfo();
                        
                        addChatMessage('System', `üëã ${data.player.username} joined the raid!`, 'system');
                    }
                });
                
                socket.on('playerLeft', (data) => {
                    console.log('üëã Player left:', data);
                    
                    if (gameState.currentRaid && data.playerId) {
                        // Remove the player from our local state
                        gameState.currentRaid.players = gameState.currentRaid.players.filter(p => p.id !== data.playerId);
                        
                        updatePlayerProfileCards();
                        updateDebugInfo();
                        
                        addChatMessage('System', `üëã ${data.username || 'A player'} left the raid`, 'system');
                    }
                });
                
                socket.on('chatMessage', (data) => {
                    console.log('üí¨ Chat message received:', data);
                    
                    if (data.username && data.message) {
                        addChatMessage(data.username, data.message, 'chat');
                    }
                });
                
                socket.on('bossAttack', (data) => {
                    console.log('üí• Boss attack:', data);
                    
                    if (data.damage && data.target) {
                        addChatMessage('Boss', `üí• Boss attacks ${data.target} for ${data.damage} damage!`, 'error');
                        
                        // Update boss HP if provided
                        if (data.newBossHP !== undefined) {
                            gameState.boss.hp = data.newBossHP;
                            updateBossDisplay();
                        }
                        
                        // Update player HP if this is our player
                        if (data.target === gameState.username && data.newPlayerHP !== undefined) {
                            if (gameState.selectedPokemon.active) {
                                gameState.selectedPokemon.active.hp = data.newPlayerHP;
                                updateYourTeamDisplay();
                            }
                        }
                    }
                });
                
                socket.on('turnAdvanced', (data) => {
                    console.log('‚è≠Ô∏è Turn advanced:', data);
                    
                    if (data.currentTurn) {
                        if (gameState.currentRaid) {
                            gameState.currentRaid.currentTurn = data.currentTurn;
                        }
                        
                        if (data.turnNumber) {
                            gameState.turnCounter = data.turnNumber;
                        }
                        
                        updateStatusBar();
                        updatePlayerProfileCards();
                        
                        addChatMessage('System', `‚è≠Ô∏è ${data.currentTurn}'s turn`, 'system');
                    }
                });
                
                socket.on('gamePhaseChanged', (data) => {
                    console.log('üéÆ Game phase changed:', data);
                    
                    if (data.phase) {
                        gameState.currentPhase = data.phase;
                        
                        if (gameState.currentRaid) {
                            gameState.currentRaid.currentPhase = data.phase;
                        }
                        
                        updateDebugInfo();
                        
                        addChatMessage('System', `üéÆ Phase changed to: ${data.phase}`, 'system');
                    }
                });
                
                socket.on('playerActionResult', (data) => {
                    console.log('üéØ Player action result:', data);
                    
                    if (data.success) {
                        // Update game state based on action result
                        if (data.newBossHP !== undefined) {
                            gameState.boss.hp = data.newBossHP;
                            updateBossDisplay();
                        }
                        
                        if (data.newPlayerHP !== undefined && data.playerId === 'player1') {
                            if (gameState.selectedPokemon.active) {
                                gameState.selectedPokemon.active.hp = data.newPlayerHP;
                                updateYourTeamDisplay();
                            }
                        }
                        
                        if (data.message) {
                            addChatMessage('Battle', data.message, 'success');
                        }
                    } else {
                        addChatMessage('System', `‚ö†Ô∏è Action failed: ${data.message || 'Unknown error'}`, 'error');
                    }
                });
                
                // Store socket globally
                window.raidSocket = socket;
            }
            
            addChatMessage('System', 'üéÆ Enhanced Pokemon TCG system initialized!', 'system');
        }

        // ==================== POKEMON DATABASE & MANAGEMENT ====================
        
        function setupPokemonDatabase() {
            // Enhanced Pokemon database with proper stats and fallback images
            window.pokemonDatabase = [
                {
                    id: 25,
                    name: 'Pikachu',
                    type: 'electric',
                    hp: 120,
                    maxHp: 120,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmZkNzAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIj5QaWthY2h1PC90ZXh0Pgo8L3N2Zz4K',
                    moves: [
                        { name: 'Thunder Shock', damage: 60, cost: ['Electric'] },
                        { name: 'Quick Attack', damage: 40, cost: ['Colorless'] }
                    ],
                    status: 'active'
                },
                {
                    id: 7,
                    name: 'Squirtle',
                    type: 'water',
                    hp: 100,
                    maxHp: 100,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDA3M2ZmIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiI+U3F1aXJ0bGU8L3RleHQ+Cjwvc3ZnPgo=',
                    moves: [
                        { name: 'Water Gun', damage: 50, cost: ['Water'] },
                        { name: 'Bubble Beam', damage: 40, cost: ['Water'] }
                    ],
                    status: 'benched'
                },
                {
                    id: 4,
                    name: 'Charmander',
                    type: 'fire',
                    hp: 110,
                    maxHp: 110,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmY0NDAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCI+Q2hhcm1hbmRlcjwvdGV4dD4KPC9zdmc+Cg==',
                    moves: [
                        { name: 'Ember', damage: 50, cost: ['Fire'] },
                        { name: 'Scratch', damage: 30, cost: ['Colorless'] }
                    ],
                    status: 'active'
                },
                {
                    id: 1,
                    name: 'Bulbasaur',
                    type: 'grass',
                    hp: 120,
                    maxHp: 120,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDBmZjAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIj5CdWxiYXNhdXI8L3RleHQ+Cjwvc3ZnPgo=',
                    moves: [
                        { name: 'Vine Whip', damage: 45, cost: ['Grass'] },
                        { name: 'Tackle', damage: 35, cost: ['Colorless'] }
                    ],
                    status: 'active'
                },
                {
                    id: 6,
                    name: 'Charizard',
                    type: 'fire',
                    hp: 180,
                    maxHp: 180,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmY4ODAwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIj5DaGFyaXphcmQ8L3RleHQ+Cjwvc3ZnPgo=',
                    moves: [
                        { name: 'Fire Blast', damage: 120, cost: ['Fire', 'Fire'] },
                        { name: 'Wing Attack', damage: 60, cost: ['Colorless'] }
                    ],
                    status: 'active'
                },
                {
                    id: 9,
                    name: 'Blastoise',
                    type: 'water',
                    hp: 170,
                    maxHp: 170,
                    image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png',
                    fallbackImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDA5OWZmIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCI+Qmxhc3RvaXNlPC90ZXh0Pgo8L3N2Zz4K',
                    moves: [
                        { name: 'Hydro Pump', damage: 110, cost: ['Water', 'Water'] },
                        { name: 'Bubble Beam', damage: 50, cost: ['Water'] }
                    ],
                    status: 'active'
                }
            ];
            
            // Set initial team (Default to first two) - ensure this always works
            if (window.pokemonDatabase && window.pokemonDatabase.length >= 2) {
                gameState.selectedPokemon.active = JSON.parse(JSON.stringify(window.pokemonDatabase[0]));
                gameState.selectedPokemon.bench = JSON.parse(JSON.stringify(window.pokemonDatabase[1]));
                
                console.log('‚úÖ Default Pokemon team set:', gameState.selectedPokemon);
                updateYourTeamDisplay();
                updateLauncherSelection();
            }
            
            console.log('‚úÖ Pokemon database initialized with', window.pokemonDatabase.length, 'Pokemon');
        }
        
        // ==================== POKEMON SELECTION SYSTEM ====================
        
        let pokemonSelectionState = {
            nextSlot: 'active', // 'active' or 'bench'
            selectedActive: null,
            selectedBench: null
        };
        
        function selectPokemon(pokemonId) {
            const pokemon = window.pokemonDatabase.find(p => p.id === pokemonId);
            if (!pokemon) return;
            
            // Clone the pokemon object to avoid reference issues
            const selectedPokemon = JSON.parse(JSON.stringify(pokemon));
            
            // Determine which slot to fill
            if (pokemonSelectionState.nextSlot === 'active') {
                pokemonSelectionState.selectedActive = selectedPokemon;
                gameState.selectedPokemon.active = selectedPokemon;
                pokemonSelectionState.nextSlot = 'bench';
                
                // Update active slot display
                const activeSlotContent = document.getElementById('activeSlotContent');
                if (activeSlotContent) {
                    activeSlotContent.innerHTML = `
                        <img src="${selectedPokemon.image}" alt="${selectedPokemon.name}">
                        <div class="pokemon-name">${selectedPokemon.name}</div>
                        <div class="pokemon-type">${selectedPokemon.type}</div>
                        <div class="pokemon-hp">HP: ${selectedPokemon.hp}</div>
                    `;
                }
                
                addSelectionFeedback(pokemonId, 'active');
                
            } else if (pokemonSelectionState.nextSlot === 'bench') {
                // Don't allow same pokemon in both slots
                if (pokemonSelectionState.selectedActive?.id === pokemonId) {
                    alert('‚ö†Ô∏è Cannot select the same Pokemon for both Active and Bench slots!');
                    return;
                }
                
                pokemonSelectionState.selectedBench = selectedPokemon;
                gameState.selectedPokemon.bench = selectedPokemon;
                
                // Update bench slot display
                const benchSlotContent = document.getElementById('benchSlotContent');
                if (benchSlotContent) {
                    benchSlotContent.innerHTML = `
                        <img src="${selectedPokemon.image}" alt="${selectedPokemon.name}">
                        <div class="pokemon-name">${selectedPokemon.name}</div>
                        <div class="pokemon-type">${selectedPokemon.type}</div>
                        <div class="pokemon-hp">HP: ${selectedPokemon.hp}</div>
                    `;
                }
                
                addSelectionFeedback(pokemonId, 'bench');
                
                // Both slots filled - show ready message
                console.log('‚úÖ Team selection complete!', gameState.selectedPokemon);
                
                // Show completion message
                const statusLog = document.getElementById('raidStatusLog');
                if (statusLog) {
                    const completeMessage = document.createElement('div');
                    completeMessage.innerHTML = `‚úÖ <strong>Team Complete!</strong> Ready to create or join raids`;
                    completeMessage.style.color = '#00a651';
                    completeMessage.style.fontWeight = 'bold';
                    statusLog.appendChild(completeMessage);
                    statusLog.scrollTop = statusLog.scrollHeight;
                }
                
                // Enable action buttons now that team is complete
                enableActionButtons();
            }
            
            // Update visual feedback
            updatePokemonSelectionVisuals();
            updateYourTeamDisplay();
        }
        
        function addSelectionFeedback(pokemonId, slot) {
            const statusLog = document.getElementById('raidStatusLog');
            if (statusLog) {
                const pokemon = window.pokemonDatabase.find(p => p.id === pokemonId);
                const message = document.createElement('div');
                message.innerHTML = `‚úÖ ${pokemon.name} selected as ${slot.toUpperCase()} Pokemon`;
                message.style.color = slot === 'active' ? '#ffcc00' : '#00a651';
                statusLog.appendChild(message);
                
                // Auto-scroll to bottom
                statusLog.scrollTop = statusLog.scrollHeight;
            }
        }
        
        function updatePokemonSelectionVisuals() {
            // Clear previous selections
            document.querySelectorAll('.pokemon-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Highlight selected pokemon
            if (pokemonSelectionState.selectedActive) {
                const activeOption = document.querySelector(`[data-pokemon-id="${pokemonSelectionState.selectedActive.id}"]`);
                if (activeOption) {
                    activeOption.classList.add('selected');
                    activeOption.style.borderColor = '#ffcc00';
                }
            }
            
            if (pokemonSelectionState.selectedBench) {
                const benchOption = document.querySelector(`[data-pokemon-id="${pokemonSelectionState.selectedBench.id}"]`);
                if (benchOption) {
                    benchOption.classList.add('selected');
                    benchOption.style.borderColor = '#00a651';
                }
            }
        }

        function updateLauncherSelection() {
            // Update the launcher display when pokemon are selected
            const activeSlot = document.getElementById('activeSlotContent');
            const benchSlot = document.getElementById('benchSlotContent');
            
            if (activeSlot && gameState.selectedPokemon.active) {
                const pokemon = gameState.selectedPokemon.active;
                activeSlot.innerHTML = `
                    <img src="${pokemon.image}" alt="${pokemon.name}">
                    <div class="pokemon-name">${pokemon.name}</div>
                    <div class="pokemon-type">${pokemon.type}</div>
                    <div class="pokemon-hp">HP: ${pokemon.hp}</div>
                `;
            }
            
            if (benchSlot && gameState.selectedPokemon.bench) {
                const pokemon = gameState.selectedPokemon.bench;
                benchSlot.innerHTML = `
                    <img src="${pokemon.image}" alt="${pokemon.name}">
                    <div class="pokemon-name">${pokemon.name}</div>
                    <div class="pokemon-type">${pokemon.type}</div>
                    <div class="pokemon-hp">HP: ${pokemon.hp}</div>
                `;
            }
        }

        function updateYourTeamDisplay() {
            const activeSlot = document.getElementById('yourActiveSlot');
            const benchSlot = document.getElementById('yourBenchSlot');
            
            if (activeSlot && gameState.selectedPokemon.active) {
                const pokemon = gameState.selectedPokemon.active;
                activeSlot.innerHTML = `
                    <img src="${pokemon.image}" alt="${pokemon.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDA0MDQwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCI+8J+OsTA8L3RleHQ+Cjwvc3ZnPgo='">
                    <div class="pokemon-overlay">
                        <div class="pokemon-name">${pokemon.name}</div>
                        <div class="pokemon-hp">${pokemon.hp}/${pokemon.maxHp}</div>
                    </div>
                `;
                activeSlot.classList.add('has-pokemon');
            }
            
            if (benchSlot && gameState.selectedPokemon.bench) {
                const pokemon = gameState.selectedPokemon.bench;
                benchSlot.innerHTML = `
                    <img src="${pokemon.image}" alt="${pokemon.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDA0MDQwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCI+8J+OsTA8L3RleHQ+Cjwvc3ZnPgo='">
                    <div class="pokemon-overlay">
                        <div class="pokemon-name">${pokemon.name}</div>
                        <div class="pokemon-hp">${pokemon.hp}/${pokemon.maxHp}</div>
                    </div>
                `;
                benchSlot.classList.add('has-pokemon');
            }
        }

        function enableActionButtons() {
            const createRaidBtn = document.getElementById('createRaidBtn');
            const joinRaidBtn = document.getElementById('joinRaidBtn');
            const quickDemoBtn = document.getElementById('quickDemoBtn');
            const testMultiplayerBtn = document.getElementById('testMultiplayerBtn');
            
            // Enable all action buttons
            [createRaidBtn, joinRaidBtn, quickDemoBtn, testMultiplayerBtn].forEach(btn => {
                if (btn) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                }
            });
        }
        
        function disableActionButtons() {
            const createRaidBtn = document.getElementById('createRaidBtn');
            const joinRaidBtn = document.getElementById('joinRaidBtn');
            const quickDemoBtn = document.getElementById('quickDemoBtn');
            const testMultiplayerBtn = document.getElementById('testMultiplayerBtn');
            
            // Disable all action buttons
            [createRaidBtn, joinRaidBtn, quickDemoBtn, testMultiplayerBtn].forEach(btn => {
                if (btn) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
            });
        }

        // ==================== DEMO RAID SETUP ====================
        
        function setupDemoRaid() {
            console.log('üîÑ Redirecting to new raid system...');
            const demoRaidId = 'DEMO-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            setupCustomRaid(demoRaidId, 'demo');
        }

        function updateAllDisplays() {
            updatePlayerProfileCards();
            updateBossDisplay();
            updateStatusBar();
            updateDebugInfo();
        }

        function updatePlayerProfileCards() {
            const playerZones = document.getElementById('playerBattleZones');
            if (!playerZones || !gameState.currentRaid?.players) return;
            
            playerZones.innerHTML = '';
            
            gameState.currentRaid.players.forEach((player, index) => {
                const profileCard = document.createElement('div');
                profileCard.className = 'player-profile-card';
                profileCard.setAttribute('data-position', player.position);
                
                if (player.id === gameState.currentRaid.currentTurn) {
                    profileCard.classList.add('current-turn');
                }
                
                if (player.isKO) {
                    profileCard.classList.add('ko');
                }
                
                profileCard.innerHTML = `
                    <div class="player-header">
                        <div class="player-name">${player.id === 'player1' ? 'üë§ ' : ''}${player.username}</div>
                        <div class="player-ko-checkbox">
                            <input type="checkbox" ${player.isKO ? 'checked' : ''} onchange="togglePlayerKO('${player.id}')">
                            <span>KO</span>
                        </div>
                    </div>
                    <div class="player-pokemon-zones">
                        <div class="player-active-zone">
                            <div class="zone-label">ACTIVE</div>
                            <div class="pokemon-card-slot active-slot ${player.active ? 'has-pokemon' : ''}">
                                ${player.active ? `
                                    <img src="${player.active.image}" alt="${player.active.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDA0MDQwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCI+8J+OsTA8L3RleHQ+Cjwvc3ZnPgo='">
                                ` : '<div class="card-placeholder"><span>ACTIVE<br>SPOT</span></div>'}
                            </div>
                        </div>
                        <div class="player-bench-zone">
                            <div class="zone-label">BENCH</div>
                            <div class="pokemon-card-slot bench-slot ${player.bench ? 'has-pokemon' : ''}">
                                ${player.bench ? `
                                    <img src="${player.bench.image}" alt="${player.bench.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNDA0MDQwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCI+8J+OsTA8L3RleHQ+Cjwvc3ZnPgo='">
                                ` : '<div class="card-placeholder"><span>BENCH</span></div>'}
                            </div>
                        </div>
                    </div>
                    <div class="player-info">
                        Active: ${player.active ? `${player.active.name} (${player.active.hp}/${player.active.maxHp})` : 'None'}<br>
                        Bench: ${player.bench ? `${player.bench.name} (${player.bench.hp}/${player.bench.maxHp})` : 'None'}
                    </div>
                `;
                
                playerZones.appendChild(profileCard);
            });
        }

        function updateBossDisplay() {
            const bossHP = document.getElementById('bossHP');
            const bossHPFill = document.getElementById('bossHPFill');
            const bossKO = document.getElementById('bossKO');
            
            if (bossHP) bossHP.textContent = gameState.boss.hp;
            if (bossKO) bossKO.textContent = gameState.boss.ko;
            
            if (bossHPFill) {
                const percentage = (gameState.boss.hp / gameState.boss.maxHp) * 100;
                bossHPFill.style.width = `${percentage}%`;
            }
        }

        function updateStatusBar() {
            const raidId = document.getElementById('raidIdStatus');
            const turnCounter = document.getElementById('turnCounter');
            const phaseIndicator = document.getElementById('phaseIndicator');
            const currentTurnDisplay = document.getElementById('currentTurnDisplay');
            
            if (raidId) raidId.textContent = gameState.currentRaid?.id || 'DEMO-RAID';
            if (turnCounter) turnCounter.textContent = gameState.turnCounter;
            if (phaseIndicator) phaseIndicator.textContent = `${gameState.currentRaid?.currentTurn || 'Boss'}'s Turn`;
            if (currentTurnDisplay) currentTurnDisplay.textContent = `${gameState.currentRaid?.currentTurn || 'Boss'} Turn`;
        }

        // ==================== EVENT HANDLERS ====================
        
        function setupEventHandlers() {
            // Team action buttons
            const attackBtn = document.getElementById('attackBtn');
            const switchBtn = document.getElementById('switchBtn');
            const defendBtn = document.getElementById('defendBtn');
            const endTurnBtn = document.getElementById('endTurnBtn');
            const leaveGameBtn = document.getElementById('leaveGameBtn');
            
            if (attackBtn) attackBtn.addEventListener('click', handleAttack);
            if (switchBtn) switchBtn.addEventListener('click', handleSwitch);
            if (defendBtn) defendBtn.addEventListener('click', handleDefend);
            if (endTurnBtn) endTurnBtn.addEventListener('click', handleEndTurn);
            if (leaveGameBtn) leaveGameBtn.addEventListener('click', handleLeaveGame);
            
            // Chat functionality
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');
            
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendChatMessage();
                });
            }
            if (sendChatBtn) sendChatBtn.addEventListener('click', sendChatMessage);
            
            // Quick damage input
            const quickDamage = document.getElementById('quickDamage');
            const addQuickDamage = document.getElementById('addQuickDamage');
            
            if (addQuickDamage) addQuickDamage.addEventListener('click', () => {
                const damage = parseInt(quickDamage?.value || 0);
                if (damage > 0) {
                    gameState.boss.hp = Math.max(0, gameState.boss.hp - damage);
                    updateBossDisplay();
                    addChatMessage('System', `üí• ${damage} damage dealt to boss!`, 'system');
                    if (quickDamage) quickDamage.value = '';
                }
            });
            
            // Boss attack card drawing
            const drawAttackCard = document.getElementById('drawAttackCard');
            if (drawAttackCard) drawAttackCard.addEventListener('click', handleDrawBossCard);
        }

        function setupUIToggling() {
            // Panel minimize/maximize functionality
            ['team', 'chat', 'debug', 'menu'].forEach(panelType => {
                const minimizeBtn = document.getElementById(`${panelType}Minimize`);
                const panelBody = document.getElementById(`${panelType}Body`);
                
                if (minimizeBtn && panelBody) {
                    minimizeBtn.addEventListener('click', () => {
                        const isMinimized = panelBody.classList.contains('minimized');
                        panelBody.classList.toggle('minimized');
                        minimizeBtn.textContent = isMinimized ? '‚àí' : '+';
                    });
                }
            });
        }

        function setupLauncherHandlers() {
            // Add event listeners for launcher buttons
            const createRaidBtn = document.getElementById('createRaidBtn');
            const joinRaidBtn = document.getElementById('joinRaidBtn');
            const quickDemoBtn = document.getElementById('quickDemoBtn');
            const testMultiplayerBtn = document.getElementById('testMultiplayerBtn');
            
            if (createRaidBtn) createRaidBtn.addEventListener('click', handleCreateRaid);
            if (joinRaidBtn) joinRaidBtn.addEventListener('click', handleJoinRaid);
            if (quickDemoBtn) quickDemoBtn.addEventListener('click', handleQuickDemo);
            if (testMultiplayerBtn) testMultiplayerBtn.addEventListener('click', handleTestMultiplayer);
        }
        
        function handleCreateRaid() {
            const raidIdInput = document.getElementById('raidIdInput');
            const usernameInput = document.getElementById('usernameInput');
            
            const customRaidId = raidIdInput?.value?.trim();
            const raidId = customRaidId || 'RAID-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            gameState.username = usernameInput?.value || 'Host Player';
            
            // If Pokemon not selected, use defaults
            if (!gameState.selectedPokemon.active || !gameState.selectedPokemon.bench) {
                console.log('‚ö†Ô∏è Using default Pokemon team');
                gameState.selectedPokemon.active = window.pokemonDatabase[0]; // Pikachu
                gameState.selectedPokemon.bench = window.pokemonDatabase[1]; // Squirtle
                updateYourTeamDisplay();
                updateLauncherSelection();
            }
            
            addChatMessage('System', `üè¥‚Äç‚ò†Ô∏è Creating raid: ${raidId}`, 'system');
            addChatMessage('System', `üéØ Your team: ${gameState.selectedPokemon.active.name} (Active) & ${gameState.selectedPokemon.bench.name} (Bench)`, 'success');
            
            // Try to create raid on server if connected
            if (window.raidSocket && window.raidSocket.connected) {
                console.log('üîó Creating raid on server...');
                
                // Send create raid request to server
                window.raidSocket.emit('createRaid', {
                    raidId: raidId,
                    username: gameState.username,
                    activePokemon: gameState.selectedPokemon.active,
                    benchPokemon: gameState.selectedPokemon.bench
                });
                
                addChatMessage('System', '‚è≥ Creating raid on server...', 'system');
                
                // Set a timeout in case server doesn't respond
                setTimeout(() => {
                    if (!gameState.currentRaid || gameState.currentRaid.id !== raidId) {
                        console.log('‚ö†Ô∏è Server timeout, creating local demo');
                        addChatMessage('System', '‚ö†Ô∏è Server timeout - creating local demo instead', 'error');
                        setupCustomRaid(raidId, 'create');
                    }
                }, 5000);
                
            } else {
                console.log('‚ö†Ô∏è No server connection, creating local demo');
                addChatMessage('System', '‚ö†Ô∏è No server connection - creating local demo', 'error');
                setupCustomRaid(raidId, 'create');
            }
        }
        
        function handleJoinRaid() {
            const raidIdInput = document.getElementById('raidIdInput');
            const usernameInput = document.getElementById('usernameInput');
            
            const raidId = raidIdInput?.value?.trim();
            if (!raidId) {
                alert('‚ö†Ô∏è Please enter a Raid ID to join');
                return;
            }
            
            gameState.username = usernameInput?.value || 'Player';
            
            // If Pokemon not selected, use defaults
            if (!gameState.selectedPokemon.active || !gameState.selectedPokemon.bench) {
                console.log('‚ö†Ô∏è Using default Pokemon team for join');
                gameState.selectedPokemon.active = window.pokemonDatabase[0]; // Pikachu
                gameState.selectedPokemon.bench = window.pokemonDatabase[1]; // Squirtle
                updateYourTeamDisplay();
                updateLauncherSelection();
            }
            
            addChatMessage('System', `üëã Joining raid: ${raidId}`, 'system');
            addChatMessage('System', `üéØ Your team: ${gameState.selectedPokemon.active.name} (Active) & ${gameState.selectedPokemon.bench.name} (Bench)`, 'success');
            
            // Try to join raid on server if connected
            if (window.raidSocket && window.raidSocket.connected) {
                console.log('üîó Joining raid on server...');
                
                // Send join raid request to server
                window.raidSocket.emit('joinRaid', {
                    raidId: raidId,
                    username: gameState.username,
                    activePokemon: gameState.selectedPokemon.active,
                    benchPokemon: gameState.selectedPokemon.bench
                });
                
                addChatMessage('System', '‚è≥ Joining raid on server...', 'system');
                
                // Set a timeout in case server doesn't respond
                setTimeout(() => {
                    if (!gameState.currentRaid || gameState.currentRaid.id !== raidId) {
                        console.log('‚ö†Ô∏è Server timeout or raid not found, creating local demo');
                        addChatMessage('System', '‚ö†Ô∏è Raid not found - creating local demo instead', 'error');
                        setupCustomRaid(raidId, 'join');
                    }
                }, 5000);
                
            } else {
                console.log('‚ö†Ô∏è No server connection, creating local demo');
                addChatMessage('System', '‚ö†Ô∏è No server connection - creating local demo', 'error');
                setupCustomRaid(raidId, 'join');
            }
        }

        function handleEndTurn() {
            addChatMessage('Battle', '‚è≠Ô∏è Turn ended', 'system');
            advanceTurn();
        }

        function advanceTurn() {
            gameState.turnCounter++;
            
            // Simple turn rotation for demo
            if (gameState.currentRaid?.players) {
                const currentIndex = gameState.currentRaid.players.findIndex(p => p.id === gameState.currentRaid.currentTurn);
                const nextIndex = (currentIndex + 1) % gameState.currentRaid.players.length;
                gameState.currentRaid.currentTurn = gameState.currentRaid.players[nextIndex].id;
            }
            
            updateAllDisplays();
        }

        function togglePlayerKO(playerId) {
            if (gameState.currentRaid?.players) {
                const player = gameState.currentRaid.players.find(p => p.id === playerId);
                if (player) {
                    player.isKO = !player.isKO;
                    addChatMessage('System', `${player.username} ${player.isKO ? 'is KO!' : 'is back in the battle!'}`, 'system');
                    updatePlayerProfileCards();
                }
            }
        }

        function handleDrawBossCard() {
            const attackCards = document.querySelectorAll('.attack-card-mini');
            const availableSlots = Array.from(attackCards).filter(card => card.textContent === '?');
            
            if (availableSlots.length > 0) {
                const randomSlot = availableSlots[Math.floor(Math.random() * availableSlots.length)];
                randomSlot.textContent = ['‚ö°', 'üî•', 'üíß', 'üåø'][Math.floor(Math.random() * 4)];
                randomSlot.classList.add('revealed');
                
                addChatMessage('System', 'üÉè Boss attack card drawn!', 'system');
            } else {
                addChatMessage('System', '‚ö†Ô∏è All attack card slots are full!', 'error');
            }
        }

        // ==================== CHAT SYSTEM ====================
        
        function addChatMessage(username, message, type = 'chat') {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            if (type === 'chat') {
                messageDiv.innerHTML = `<strong>${username}:</strong> ${message}`;
            } else {
                messageDiv.innerHTML = message;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Limit chat history
            while (chatMessages.children.length > 50) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
        }
        
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            if (!chatInput) return;
            
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Send to server if connected
            if (window.raidSocket && window.raidSocket.connected && gameState.currentRaid) {
                window.raidSocket.emit('chatMessage', {
                    raidId: gameState.currentRaid.id,
                    username: gameState.username,
                    message: message
                });
            }
            
            // Always show locally for immediate feedback
            addChatMessage(gameState.username, message, 'chat');
            chatInput.value = '';
            
            // Only add AI echo for offline/demo mode
            if (!window.raidSocket || !window.raidSocket.connected) {
                setTimeout(() => {
                    const responses = [
                        'Nice move!',
                        'Good strategy!',
                        'Let\'s see what happens next!',
                        'That was unexpected!',
                        'Great teamwork!'
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addChatMessage('AI Trainer Red', randomResponse, 'chat');
                }, 1000 + Math.random() * 2000);
            }
        }

        // ==================== DEBUG FUNCTIONS ====================
        
        function updateDebugInfo() {
            const socketStatus = document.getElementById('socketStatus');
            const playerCount = document.getElementById('playerCount');
            const gamePhase = document.getElementById('gamePhase');
            
            if (socketStatus) socketStatus.textContent = gameState.isConnected ? 'Connected' : 'Disconnected';
            if (playerCount) playerCount.textContent = `${gameState.currentRaid?.players?.length || 0}/4`;
            if (gamePhase) gamePhase.textContent = gameState.currentPhase;
        }

        function updateSocketStatus(status) {
            const socketStatus = document.getElementById('socketStatus');
            if (socketStatus) {
                socketStatus.textContent = status;
                socketStatus.style.color = status === 'Connected' ? '#00a651' : '#dc143c';
            }
        }

        // ==================== GLOBAL DEBUG FUNCTIONS ====================
        
        function testBossAttack() {
            const damage = 50 + Math.floor(Math.random() * 50);
            addChatMessage('Boss', `üí• Boss attacks for ${damage} damage!`, 'error');
            
            if (gameState.currentRaid?.players) {
                const randomPlayer = gameState.currentRaid.players[Math.floor(Math.random() * gameState.currentRaid.players.length)];
                if (randomPlayer.active) {
                    randomPlayer.active.hp = Math.max(0, randomPlayer.active.hp - damage);
                    updatePlayerProfileCards();
                }
            }
        }

        function testPlayerDamage() {
            if (gameState.selectedPokemon.active) {
                const damage = 20 + Math.floor(Math.random() * 30);
                gameState.selectedPokemon.active.hp = Math.max(0, gameState.selectedPokemon.active.hp - damage);
                addChatMessage('Debug', `üîß ${damage} damage applied to your active Pokemon`, 'system');
                updateYourTeamDisplay();
                updatePlayerProfileCards();
            }
        }

        function testHealPlayer() {
            if (gameState.selectedPokemon.active) {
                const heal = 20 + Math.floor(Math.random() * 30);
                gameState.selectedPokemon.active.hp = Math.min(gameState.selectedPokemon.active.maxHp, gameState.selectedPokemon.active.hp + heal);
                addChatMessage('Debug', `üíö ${heal} HP restored to your active Pokemon`, 'system');
                updateYourTeamDisplay();
                updatePlayerProfileCards();
            }
        }

        function resetBattle() {
            gameState.boss.hp = gameState.boss.maxHp;
            gameState.turnCounter = 1;
            
            if (gameState.currentRaid?.players) {
                gameState.currentRaid.players.forEach(player => {
                    if (player.active) player.active.hp = player.active.maxHp;
                    if (player.bench) player.bench.hp = player.bench.maxHp;
                    player.isKO = false;
                });
            }
            
            // Reset boss attack cards
            const attackCards = document.querySelectorAll('.attack-card-mini');
            attackCards.forEach(card => {
                card.textContent = '?';
                card.classList.remove('revealed');
            });
            
            addChatMessage('Debug', 'üîß Battle reset - all Pokemon restored!', 'system');
            updateAllDisplays();
        }

        // Make functions available globally for onclick handlers
        window.testBossAttack = testBossAttack;
        window.testPlayerDamage = testPlayerDamage;
        window.testHealPlayer = testHealPlayer;
        window.resetBattle = resetBattle;
        window.togglePlayerKO = togglePlayerKO;
        window.selectPokemon = selectPokemon;
        window.handleAttack = handleAttack;
        window.handleSwitch = handleSwitch;
        window.handleDefend = handleDefend;
        
        console.log('üéÆ Authentic Pokemon TCG JavaScript loaded!');

        // ==================== BOSS SYSTEM ====================
        
        const raidBosses = [
            {
                id: 25,
                name: 'Pikachu ‚òÖ‚òÖ‚òÖ',
                type: 'electric',
                hp: 2800,
                maxHp: 2800,
                level: 3,
                image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png',
                attacks: ['‚ö°', 'üå©Ô∏è', 'üí´', '‚≠ê']
            },
            {
                id: 6,
                name: 'Charizard ‚òÖ‚òÖ‚òÖ‚òÖ',
                type: 'fire',
                hp: 3200,
                maxHp: 3200,
                level: 4,
                image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png',
                attacks: ['üî•', 'üå™Ô∏è', 'üí•', 'üåü']
            },
            {
                id: 9,
                name: 'Blastoise ‚òÖ‚òÖ‚òÖ‚òÖ',
                type: 'water',
                hp: 3100,
                maxHp: 3100,
                level: 4,
                image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png',
                attacks: ['üíß', 'üåä', '‚ùÑÔ∏è', 'üíé']
            },
            {
                id: 150,
                name: 'Mewtwo ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
                type: 'psychic',
                hp: 4000,
                maxHp: 4000,
                level: 5,
                image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png',
                attacks: ['üîÆ', 'üëÅÔ∏è', 'üíú', 'üåå']
            }
        ];
        
        function selectRandomBoss() {
            const boss = raidBosses[Math.floor(Math.random() * raidBosses.length)];
            gameState.boss = { ...boss, ko: 0 };
            
            // Update boss display
            const bossImage = document.getElementById('bossImage');
            const bossName = document.getElementById('bossName');
            
            if (bossImage) bossImage.src = boss.image;
            if (bossName) bossName.textContent = boss.name;
            
            return boss;
        }
        
        function setBoss(bossId) {
            const boss = raidBosses.find(b => b.id === bossId);
            if (boss) {
                gameState.boss = { ...boss, ko: 0 };
                
                // Update boss display
                const bossImage = document.getElementById('bossImage');
                const bossName = document.getElementById('bossName');
                
                if (bossImage) bossImage.src = boss.image;
                if (bossName) bossName.textContent = boss.name;
                
                updateBossDisplay();
                addChatMessage('System', `üè¥‚Äç‚ò†Ô∏è Boss ${boss.name} has appeared!`, 'system');
            }
            return boss;
        }

        function setupCreatedRaid(raidData) {
            console.log('üè¥‚Äç‚ò†Ô∏è Setting up created raid:', raidData);
            
            // Hide launcher and show game
            const launcher = document.getElementById('raidLauncher');
            const container = document.getElementById('raidContainer');
            
            if (launcher) launcher.style.display = 'none';
            if (container) container.style.display = 'block';
            
            // Set up raid state
            gameState.currentRaid = {
                id: raidData.raidId,
                mode: 'multiplayer',
                players: [{
                    id: 'player1',
                    username: gameState.username,
                    active: gameState.selectedPokemon.active,
                    bench: gameState.selectedPokemon.bench,
                    isKO: false,
                    position: 1
                }],
                currentPhase: 'lobby',
                currentTurn: 'player1'
            };
            
            // Select boss for the raid
            const selectedBoss = selectRandomBoss();
            
            // Update all displays
            updateAllDisplays();
            
            addChatMessage('System', 'üéÆ Raid created! Waiting for other players...', 'system');
            addChatMessage('System', `üè¥‚Äç‚ò†Ô∏è Boss ${selectedBoss.name} is waiting...`, 'system');
        }
        
        function setupJoinedRaid(raidData) {
            console.log('ü§ù Setting up joined raid:', raidData);
            
            // Hide launcher and show game
            const launcher = document.getElementById('raidLauncher');
            const container = document.getElementById('raidContainer');
            
            if (launcher) launcher.style.display = 'none';
            if (container) container.style.display = 'block';
            
            // Set up raid state from server data
            gameState.currentRaid = {
                id: raidData.raidId,
                mode: 'multiplayer',
                players: raidData.players || [],
                currentPhase: raidData.phase || 'battle',
                currentTurn: raidData.currentTurn || 'player1'
            };
            
            // Ensure our player is in the raid with correct Pokemon
            const ourPlayer = gameState.currentRaid.players.find(p => p.username === gameState.username);
            if (ourPlayer) {
                ourPlayer.active = gameState.selectedPokemon.active;
                ourPlayer.bench = gameState.selectedPokemon.bench;
            } else {
                // Add ourselves if not already in the player list
                gameState.currentRaid.players.push({
                    id: `player${gameState.currentRaid.players.length + 1}`,
                    username: gameState.username,
                    active: gameState.selectedPokemon.active,
                    bench: gameState.selectedPokemon.bench,
                    isKO: false,
                    position: gameState.currentRaid.players.length + 1
                });
            }
            
            // Set up boss if provided
            if (raidData.boss) {
                gameState.boss = raidData.boss;
                setBoss(raidData.boss.id);
            } else {
                // Set random boss for joined raid
                selectRandomBoss();
            }
            
            // Update all displays
            updateAllDisplays();
            
            addChatMessage('System', 'üéÆ Raid joined successfully! Battle ready!', 'system');
            addChatMessage('System', `üéØ Your team: ${gameState.selectedPokemon.active.name} (Active) & ${gameState.selectedPokemon.bench.name} (Bench)`, 'success');
        }

        function handleQuickDemo() {
            const usernameInput = document.getElementById('usernameInput');
            gameState.username = usernameInput?.value || 'Demo Player';
            
            const demoRaidId = 'DEMO-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            addChatMessage('System', `üé≤ Starting quick demo: ${demoRaidId}`, 'system');
            setupCustomRaid(demoRaidId, 'demo');
        }
        
        function handleTestMultiplayer() {
            const usernameInput = document.getElementById('usernameInput');
            gameState.username = usernameInput?.value || 'Test Player';
            
            const testRaidId = 'TEST-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            addChatMessage('System', 'üß™ Testing multiplayer features...', 'system');
            setupCustomRaid(testRaidId, 'test');
        }
        
        // ==================== CUSTOM RAID SETUP ====================
        
        function setupCustomRaid(raidId, mode = 'create') {
            console.log(`üéÆ Setting up ${mode} raid: ${raidId}`);
            
            // Hide launcher and show game
            const launcher = document.getElementById('raidLauncher');
            const container = document.getElementById('raidContainer');
            
            if (launcher) launcher.style.display = 'none';
            if (container) container.style.display = 'block';
            
            // Set up raid with custom ID
            gameState.currentRaid = {
                id: raidId,
                mode: mode,
                players: [
                    {
                        id: 'player1',
                        username: gameState.username,
                        active: gameState.selectedPokemon.active,
                        bench: gameState.selectedPokemon.bench,
                        isKO: false,
                        position: 1
                    }
                ],
                currentPhase: 'battle',
                currentTurn: 'player1'
            };
            
            // Select appropriate boss based on mode
            let selectedBoss;
            switch (mode) {
                case 'demo':
                    selectedBoss = setBoss(25); // Pikachu for demos
                    break;
                case 'test':
                    selectedBoss = setBoss(150); // Mewtwo for testing
                    break;
                default:
                    selectedBoss = selectRandomBoss(); // Random boss for custom raids
            }
            
            // Add AI players for demo/test modes
            if (mode === 'demo' || mode === 'test') {
                gameState.currentRaid.players.push({
                    id: 'player2',
                    username: 'AI Trainer Red',
                    active: window.pokemonDatabase[2], // Charmander
                    bench: window.pokemonDatabase[3], // Bulbasaur
                    isKO: false,
                    position: 2
                });
                
                if (mode === 'test') {
                    // Add more AI players for testing
                    gameState.currentRaid.players.push({
                        id: 'player3',
                        username: 'AI Trainer Blue',
                        active: window.pokemonDatabase[4], // Charizard
                        bench: window.pokemonDatabase[5], // Blastoise
                        isKO: false,
                        position: 3
                    });
                }
            }
            
            // Update all displays
            updateAllDisplays();
            
            // Send appropriate messages
            switch (mode) {
                case 'create':
                    addChatMessage('System', `üéÆ Raid "${raidId}" created! Waiting for other players...`, 'system');
                    addChatMessage('System', 'üîó Share this Raid ID with friends to join', 'system');
                    break;
                case 'join':
                    addChatMessage('System', `ü§ù Attempting to join raid "${raidId}"...`, 'system');
                    addChatMessage('System', '‚è≥ Connecting to raid...', 'system');
                    // In a real implementation, this would connect to the server
                    setTimeout(() => {
                        addChatMessage('System', '‚úÖ Successfully joined the raid!', 'system');
                    }, 1000);
                    break;
                case 'demo':
                    addChatMessage('System', `üéÆ Demo raid started! Battle against AI trainers!`, 'system');
                    addChatMessage('System', '‚öîÔ∏è Use the action buttons to attack, switch, or defend', 'system');
                    addChatMessage('AI Trainer Red', 'Let the battle begin!', 'chat');
                    break;
                case 'test':
                    addChatMessage('System', `üß™ Test raid started with multiple AI players!`, 'system');
                    addChatMessage('System', 'üîß All multiplayer features active for testing', 'system');
                    addChatMessage('AI Trainer Red', 'Ready for battle!', 'chat');
                    addChatMessage('AI Trainer Blue', 'Let\'s test this system!', 'chat');
                    break;
            }
        }

        function handleLeaveGame() {
            // Show confirmation
            if (confirm('Are you sure you want to leave the raid battle?')) {
                // Hide game and show launcher
                const launcher = document.getElementById('raidLauncher');
                const container = document.getElementById('raidContainer');
                
                if (launcher) launcher.style.display = 'block';
                if (container) container.style.display = 'none';
                
                // Reset game state
                gameState.currentRaid = null;
                gameState.currentPhase = 'lobby';
                
                addChatMessage('System', 'üëã Left the raid battle', 'system');
                console.log('üö™ User left the game');
            }
        }

        // ==================== GAME ACTION HANDLERS ====================
        
        function handleAttack() {
            if (!gameState.selectedPokemon.active) {
                addChatMessage('System', '‚ö†Ô∏è No active Pokemon to attack with!', 'error');
                return;
            }
            
            const pokemon = gameState.selectedPokemon.active;
            const move = pokemon.moves[0]; // Use first move for demo
            
            if (move) {
                const damage = move.damage;
                gameState.boss.hp = Math.max(0, gameState.boss.hp - damage);
                
                addChatMessage('Battle', `üí• ${pokemon.name} used ${move.name} for ${damage} damage!`, 'success');
                
                // Send to server if connected
                if (window.raidSocket && window.raidSocket.connected) {
                    window.raidSocket.emit('playerAction', {
                        type: 'playerAttack',
                        damage: damage,
                        attackName: move.name,
                        pokemonUsed: pokemon.name,
                        energyCost: move.cost
                    });
                }
                
                if (gameState.boss.hp <= 0) {
                    addChatMessage('System', 'üéâ Boss defeated! Victory!', 'success');
                }
                
                updateBossDisplay();
                advanceTurn();
            }
        }

        function handleSwitch() {
            if (!gameState.selectedPokemon.active || !gameState.selectedPokemon.bench) {
                addChatMessage('System', '‚ö†Ô∏è Need both active and bench Pokemon to switch!', 'error');
                return;
            }
            
            // Swap active and bench Pokemon
            const temp = gameState.selectedPokemon.active;
            gameState.selectedPokemon.active = gameState.selectedPokemon.bench;
            gameState.selectedPokemon.bench = temp;
            
            // Update the current player's Pokemon in raid
            if (gameState.currentRaid?.players) {
                const currentPlayer = gameState.currentRaid.players.find(p => p.id === 'player1');
                if (currentPlayer) {
                    currentPlayer.active = gameState.selectedPokemon.active;
                    currentPlayer.bench = gameState.selectedPokemon.bench;
                }
            }
            
            addChatMessage('Battle', `üîÑ Switched to ${gameState.selectedPokemon.active.name}!`, 'success');
            updateYourTeamDisplay();
            updatePlayerProfileCards();
            advanceTurn();
        }

        function handleDefend() {
            addChatMessage('Battle', 'üõ°Ô∏è Defending this turn - damage reduced by 50%', 'system');
            
            // Send to server if connected
            if (window.raidSocket && window.raidSocket.connected) {
                window.raidSocket.emit('playerAction', {
                    type: 'playerDefend',
                    defenseType: 'guard',
                    damageReduction: 50
                });
            }
            
            advanceTurn();
        }
        
        // Make functions globally available
        window.selectPokemon = selectPokemon;
        window.handleAttack = handleAttack;
        window.handleSwitch = handleSwitch;
        window.handleDefend = handleDefend;
    </script>

    <!-- JavaScript disabled fallback -->
    <noscript>
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; display: flex; align-items: center; justify-content: center; z-index: 9999; text-align: center; font-family: Arial, sans-serif;">
            <div>
                <h1>‚ö° JavaScript Required</h1>
                <p>This Pokemon Raid Battle System requires JavaScript to function.</p>
                <p>Please enable JavaScript in your browser and reload the page.</p>
            </div>
        </div>
    </noscript>
</body>
</html> 