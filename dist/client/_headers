# PTCG-Sim-Meta Cloudflare Pages Headers Configuration
# This file controls HTTP headers for static files and paths

# Global headers for all files
/*
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Referrer-Policy: strict-origin-when-cross-origin
  Permissions-Policy: camera=(), microphone=(), geolocation=()
  Content-Security-Policy: default-src 'self' *.cloudflare.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.socket.io https://ptcg-sim-meta.jasonh1993.workers.dev https://ptcg-sim-meta-dev.jasonh1993.workers.dev; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' wss: https: ws:; font-src 'self'; object-src 'none'; media-src 'self'; frame-src 'self'; worker-src 'self' blob:;

# CRITICAL: Ensure proper MIME types for different file types
# HTML files
*.html
  Content-Type: text/html; charset=utf-8

# Set correct MIME types for JavaScript files
*.js
  Content-Type: application/javascript; charset=utf-8

# Set correct MIME types for JavaScript module files
*.mjs
  Content-Type: application/javascript; charset=utf-8

# Set correct MIME types for CSS files
*.css
  Content-Type: text/css; charset=utf-8

# Set correct MIME types for JSON files
*.json
  Content-Type: application/json; charset=utf-8

# Handle exact path matches for worker resources first to prevent SPA fallback
/workers/src/utils/logging.js    
  Content-Type: application/javascript; charset=utf-8

/workers/src/utils/cors.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/utils/key-generator.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/utils/error-handling.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/db/client.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/db/game-state.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/api/game-state.js
  Content-Type: application/javascript; charset=utf-8

/workers/src/api/health.js
  Content-Type: application/javascript; charset=utf-8

/workers/dist/worker.js
  Content-Type: application/javascript; charset=utf-8

/workers/dist/worker.js.map
  Content-Type: application/json; charset=utf-8

# Handle module path redirects
/src/config/*                 /src/config/:splat                 200
/src/services/*               /src/services/:splat               200
/js/metadata/*                /js/metadata/:splat                200
/src/initialization/*         /src/initialization/:splat         200
/src/initialization/socket-event-listeners/*  /src/initialization/socket-event-listeners/:splat  200
/src/initialization/global-variables/*        /src/initialization/global-variables/:splat        200
/src/initialization/config/*                 /src/initialization/config/:splat                  200
/src/initialization/document-event-listeners/* /src/initialization/document-event-listeners/:splat 200
/src/initialization/load-import-data/*       /src/initialization/load-import-data/:splat       200
/src/initialization/mutation-observers/*     /src/initialization/mutation-observers/:splat     200
/src/setup/*                  /src/setup/:splat                  200
/src/setup/general/*          /src/setup/general/:splat          200
/src/utils/*                  /src/utils/:splat                  200
/src/actions/*                /src/actions/:splat                200
/src/actions/general/*        /src/actions/general/:splat        200
/src/actions/keybinds/*       /src/actions/keybinds/:splat       200

# API endpoints - these need to be handled by the worker
/api/*                        /api/:splat                        200
/health                       /health                            200

# Static assets
/src/assets/*                 /src/assets/:splat                 200
/src/css/*                    /src/css/:splat                    200

# Handle workers paths correctly
/workers/src/utils/*          /workers/src/utils/:splat          200
/workers/src/api/*            /workers/src/api/:splat            200
/workers/src/db/*             /workers/src/db/:splat             200
/workers/dist/*               /workers/dist/:splat               200

# SPA fallback - direct all other routes to index.html
/*                            /index.html                        200